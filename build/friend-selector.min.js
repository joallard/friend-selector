(function(){var a;a={friends:[],elements:{},_options:{elementSelector:"[data-friend-selector]",pagination:10,selectCallback:function(){},confirm:!0,injectStyle:"full",dictionary:{title:"Choose a friend",confirm:"Choose",loading:"Loading...",noFriends:"No friends are using this app yet."}},options:function(a){return a?this._options=_.merge(this._options,a):this._options},launch:function(){var b,c;b=a,c=FBLogin.ensurePermission("user_friends"),c.done(function(){return b.open()}),c.fail(function(){return b._complainAboutPermissions()})},open:function(){this._findElement(),this.element.style.display="block",this._basicDOMElements(),this._fetchFriends().done(function(a){return function(){return a._showFriends()}}(this))},close:function(){this.element.style.display="none",this.elements.overlay.remove(),this.dialog.remove()},_fetchFriends:function(){var a;return this._toggleLoading(!0),a=$.Deferred(),FB.api("/me/friends",function(b){return function(c){return c.data?0!==c.data.length?(b.friends=c.data,a.resolve()):(console.warn("FriendSelector: No friends found"),b._infoNoFriends(),a.reject(),b._toggleLoading(!1)):(console.error("FriendSelector: Not logged in"),a.reject(),b._toggleLoading(!1))}}(this),{limit:9999}),a.promise()},_basicDOMElements:function(){var a,b,c,d,e,f,g,h,i,j,k;this.elements.overlay=this._createElement("div",{"class":"overlay","in":this.element}),e=this._createElement("div",{"class":"dialog"}),k=this._createElement("div",{"class":"title-bar"}),f=this._createElement("div",{"class":"friends"}),d=this._createElement("div",{"class":"controls"}),h=this._createElement("div",{"class":"pagination","in":d}),this.elements.prev=i=this._createElement("button",{"in":h,content:"&#x25c4;"}),this.elements.next=g=this._createElement("button",{"in":h,content:"&#x25ba;"}),i.disabled=!0,g.disabled=!0,i.addEventListener("click",function(a){return function(){return a.prevPage()}}(this)),g.addEventListener("click",function(a){return function(){return a.nextPage()}}(this)),this.elements.paginationCount=this._createElement("span",{"class":"page-numbers","in":h}),a=this._createElement("div",{"class":"actions","in":d}),this._options.confirm&&(c=this._createElement("button",{content:this._options.dictionary.confirm,"class":"confirm","in":a}),c.disabled=!0,c.setAttribute("data-confirm",""),c.addEventListener("click",function(a){return function(){return a._confirm()}}(this)),this.elements.confirm=c),b=this._createElement("a",{content:"&times;","in":k,"class":"close"}),b.href="#",b.addEventListener("click",function(a){return function(){return a.close()}}(this)),j=this._createElement("h1",{"in":k,content:this._options.dictionary.title}),this.element.appendChild(e),e.appendChild(k),e.appendChild(f),e.appendChild(d),this.dialog=e,this.elements.friends=f},_toggleLoading:function(a){return a?(this._flushFriends(),this.elements.loading=this._createElement("div",{"class":"loading info message","in":this.elements.friends,content:this._options.dictionary.loading})):this.elements.loading.remove()},_infoNoFriends:function(){this._createElement("div",{"class":"no-friends info message","in":this.elements.friends,content:this._options.dictionary.noFriends})},_showFriends:function(){return this._nPages=Math.ceil(this.friends.length/this._options.pagination),this._nPages>1&&this._enablePagination,this._showPage(0)},_showPage:function(a){var b,c,d,e;0>a||a>this._nPages-1||(this._nPage=a,this._ablePaginationButtons(),this._reflectPaginationCount(),d=this._options.pagination,b=a*d,c=(a+1)*d,e=_.slice(this.friends,b,c),this._flushFriends(),_.each(e,function(a){return function(b){return a._addDOMFriend(b)}}(this)))},nextPage:function(){return this._showPage(this._nPage+1)},prevPage:function(){return this._showPage(this._nPage-1)},_ablePaginationButtons:function(){return this._nPages<2?(this.elements.prev.disabled=!0,this.elements.next.disabled=!0):0===this._nPage?(this.elements.prev.disabled=!0,this.elements.next.disabled=!1):this._nPage===this._nPages-1?(this.elements.prev.disabled=!1,this.elements.next.disabled=!0):(this.elements.prev.disabled=!1,this.elements.next.disabled=!1)},_reflectPaginationCount:function(){return this.elements.paginationCount.innerHTML=this._nPage+1+"/"+this._nPages},_flushFriends:function(){return this.elements.friends.innerHTML=""},_addDOMFriend:function(a){var b,c,d;return b=this._createElement("div",{"in":this.elements.friends,"class":"friend"}),c=document.createElement("a"),c.href="#",c.innerHTML=a.name,c.addEventListener("click",function(c){return function(){return c._selectFriend(a,b)}}(this)),d=document.createElement("img"),d.src="//graph.facebook.com/"+a.id+"/picture",b.appendChild(d),b.appendChild(c)},_selectFriend:function(a,b){return this._resetSelection(),b.className+=" selected",this.selection=a,this._options.confirm?this.elements.confirm.disabled=!1:this._confirm()},_resetSelection:function(){var a;a=this.elements.friends.querySelector(".selected"),a&&(a.className=a.className.replace(" selected",""))},_confirm:function(){return this.selection?(this._options.selectCallback.call(this,this.selection),this.close()):void 0},_findElement:function(){if(this.element||(this.element=document.querySelector(this._options.elementSelector)),!this.element)throw"FriendSelector: Element not found"},_complainAboutPermissions:function(){return console.error("FriendSelector: Permission to Facebook friends denied")},_createElement:function(a,b){var c;return null==b&&(b={}),c=document.createElement(a),b["class"]&&(c.className=b["class"]),b.content&&(c.innerHTML=b.content),b["in"]&&b["in"].appendChild(c),c}},window.FriendSelector=a}).call(this);